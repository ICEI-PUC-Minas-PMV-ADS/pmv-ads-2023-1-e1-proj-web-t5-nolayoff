var db_vagas_inicial = {
    "vagas": [
        {
            "id": 1,
            "descricao": "vaga 1 - Analista de Desenvolvimento BPM 1",
            "empresa": "Sicoob Credicom",
            'sobreaempresa': "O Sicoob Credicom é uma cooperativa financeira criada para os profissionais, estudantes e empresários da área de saúde. Com 31 anos de experiência no mercado, é uma instituição financeira sólida, autorizada pelo Banco Central e fiscalizada pelo Sicoob Central Cecremge – Central das Cooperativas de Economia e Crédito Mútuo do Estado de Minas Gerais.",
            'sobreavaga': "Conectar Pessoas para promover Prosperidade com Justiça Financeira. Este é o PROPÓSITO do Sicoob Credicom, a maior cooperativa financeira da área de saúde do Brasil. Com 31 anos de experiência, somos uma instituição financeira sólida, regulada pelo Banco Central.",
            "tempo": "Integral",
            "cargo": "Analista de Sistemas",
            "nivel": "Pleno;sênior",
            "competenciadavaga": "Clojure;Recursividade;Interfaces;Goroutine;Reflection;Padrão REST;Testes unitários;Banco de dados PostgreSQL;Docker",
            "salario": "A combinar",
            "email": "sicob@sicob.email.com",
            "telefone": "31-322-736-8031",
            "website": "http://sicob.com"

        },
        {
            "id": 2,
            "descricao": "vaga 2 - Analista de sistema PL (Pessoa Desenvolvedora full stack) 2",
            "empresa": "Siemens",
            'sobreaempresa': "A Siemens é uma empresa global focada em tecnologia e inovação e está presente no Brasil há mais de 155 anos.",
            'sobreavaga': "Você quer desempenhar um papel essencial na construção de um futuro melhor, trabalhando em projetos que possuem impacto na sociedade e no meio ambiente? Está interessado(a) em buscar por soluções revolucionárias que maximizem a criação de valor? Então junte-se à nossa equipe e venha construir o futuro na Siemens!",
            "tempo": "Integral",
            "cargo": "Desenvolvedor Full stack",
            "nivel": "Pleno",
            "competenciadavaga": "LIMS;JSF (JavaServer Faces);Hibernate;Engenharia de controle e automação;Desenvolvimento de soluções;Desenvolvimento de sistemas;Controle de produção;Banco de dados Oracle;Aplicações industriais",
            "salario": "7500,00",
            "email": "siemens@siemens.email.com",
            "telefone": "31-322-736-8031",
            "website": "http://Siemens.com"
        },
        {
            "id": 3,
            "descricao": "vaga 3 - Analista de Sistemas e Aplicações 3",
            "empresa": "SSA - São Salvador Alimentos",
            'sobreaempresa': "Grupo empresarial que atua no ramo alimentício atendendo mercados dentro e fora do Brasil. A São Salvador Alimentos acredita que a maior riqueza de uma organização são os seus colaboradores, então o respeito ao fator humano é sempre o mais importante.",
            'sobreavaga': "A OPORTUNIDADE Como Analista de Sistemas e Aplicações, você atuará de forma estratégica no T.I, em alinhamento com políticas e diretrizes da SSA. Sendo responsável por garantir a manutenção e o desenvolvimento de sistemas que apoiem os processos do negócio propondo soluções de melhorias e avaliar oportunidades de implantação de novas tecnologias a partir de um conhecimento profundo sobre os sistemas e os processos de negócio suportados por ele.",
            "tempo": "Integral",
            "cargo": "Analista de sistemas",
            "nivel": "Pleno",
            "competenciadavaga": "CSS;Desenvolvimento de back-end;ERP;Go;HTML;JQuery;JavaScript:Lógica;PHP",
            "salario": "A combinar",
            "email": "SSA@SSA.email.com",
            "telefone": "31-322-736-8031",
            "website": "http://SSA.com"
        },
        {
            "id": 4,
            "descricao": "vaga 4 - Analista de TI - DB APOIO INTEGRAL. 4",
            "empresa": "wabtec",
            'sobreaempresa': "With more than 27,000 employees in over 50 countries around the world, Wabtec provides innovative solutions to our freight rail, passenger transit and industrial customers. Our history of innovation dates back a century and a half to George Westinghouse's invention of the air brake.",
            'sobreavaga': "Empresa localizada na cidade de contagem/ mg do ramo administrativo contrata analista de ti Requisitos: • desejável ensino superior completo em tecnologia da informação ou áreas afins.",
            "tempo": "Integral",
            "cargo": "Analista de sistemas",
            "nivel": "Pleno",
            "competenciadavaga": "CSS;Desenvolvimento de back-end;ERP;Go;HTML;JQuery;JavaScript:Lógica;PHP",
            "salario": "3500,00",
            "email": "wabtec@wabtec.email.com",
            "telefone": "31-322-736-8031",
            "website": "http://wabtec.com"
        },
        {
            "id": 5,
            "descricao": "Desenvolvedor Fullstack",
            "empresa": "Empresa A",
            "sobreaempresa": "Empresa A é uma empresa de tecnologia especializada em soluções web.",
            "sobreavaga": "Estamos procurando um desenvolvedor Fullstack para se juntar à nossa equipe.",
            "tempo": "Integral",
            "cargo": "Desenvolvedor Fullstack",
            "nivel": "Júnior",
            "competenciadavaga": "HTML;CSS;JavaScript;Node.js;SQL",
            "salario": "R$ 5.000,00",
            "email": "contato@empresaA.com",
            "telefone": "(11) 1234-5678",
            "website": "www.empresaA.com"
        },
        {
            "id": 6,
            "descricao": "Analista de Sistemas",
            "empresa": "Empresa B",
            "sobreaempresa": "Empresa B é uma empresa de TI com foco em soluções empresariais.",
            "sobreavaga": "Estamos contratando um analista de sistemas para trabalhar em projetos de grande porte.",
            "tempo": "Integral",
            "cargo": "Analista de Sistemas",
            "nivel": "Pleno",
            "competenciadavaga": "Experiência em Análise de requisitos;Modelagem de dados;Linguagens de programação",
            "salario": "R$ 7.000,00",
            "email": "contato@empresaB.com",
            "telefone": "(11) 9876-5432",
            "website": "www.empresaB.com"
        },
        {
            "id": 7,
            "descricao": "Programador Frontend",
            "empresa": "Empresa C",
            "sobreaempresa": "Empresa C é uma agência de desenvolvimento web focada em projetos modernos.",
            "sobreavaga": "Estamos em busca de um programador frontend com experiência em tecnologias web.",
            "tempo": "Integral",
            "cargo": "Programador Frontend",
            "nivel": "Pleno",
            "competenciadavaga": "HTML;CSS;JavaScript;Frameworks de frontend",
            "salario": "R$ 6.000,00",
            "email": "contato@empresaC.com",
            "telefone": "(11) 2345-6789",
            "website": "www.empresaC.com"
        },
        {
            "id": 8,
            "descricao": "Analista de Dados",
            "empresa": "Empresa D",
            "sobreaempresa": "Empresa D é uma empresa de consultoria especializada em análise de dados.",
            "sobreavaga": "Estamos contratando um analista de dados para auxiliar em projetos de análise estatística.",
            "tempo": "Integral",
            "cargo": "Analista de Dados",
            "nivel": "Sênior",
            "competenciadavaga": "Experiência em Análise de dados;estatística",
            "salario": "R$ 8.000,00",
            "email": "contato@empresaD.com",
            "telefone": "(11) 8765-4321",
            "website": "www.empresaD.com"
        },
        {
            "id": 9,
            "descricao": "Desenvolvedor Mobile",
            "empresa": "Empresa E",
            "sobreaempresa": "Empresa E é uma startup de tecnologia focada no desenvolvimento de aplicativos móveis.",
            "sobreavaga": "Estamos procurando um desenvolvedor mobile para trabalhar em projetos inovadores.",
            "tempo": "Integral",
            "cargo": "Desenvolvedor Mobile",
            "nivel": "Júnior",
            "competenciadavaga": "Desenvolvimento de aplicativos móveis;React;Node.js",
            "salario": "R$ 4.500,00",
            "email": "contato@empresaE.com",
            "telefone": "(11) 5432-1098",
            "website": "www.empresaE.com"
        },
        {
            "id": 10,
            "descricao": "Engenheiro de Software",
            "empresa": "Empresa F",
            "sobreaempresa": "Empresa F é uma empresa de desenvolvimento de software para o setor automotivo.",
            "sobreavaga": "Estamos em busca de um engenheiro de software com conhecimentos em sistemas embarcados.",
            "tempo": "Integral",
            "cargo": "Engenheiro de Software",
            "nivel": "Pleno",
            "competenciadavaga": "Desenvolvimento de sistemas;PHP;Javascript",
            "salario": "R$ 7.500,00",
            "email": "contato@empresaF.com",
            "telefone": "(11) 6789-5432",
            "website": "www.empresaF.com"
        },
        {
            "id": 11,
            "descricao": "Desenvolvedor PHP",
            "empresa": "Empresa G",
            "sobreaempresa": "Empresa G é uma agência digital que desenvolve soluções web personalizadas.",
            "sobreavaga": "Estamos procurando um desenvolvedor PHP para trabalhar em projetos de clientes.",
            "tempo": "Integral",
            "cargo": "Desenvolvedor PHP",
            "nivel": "Pleno",
            "competenciadavaga": "PHP;Frameworks MVC;Bancos de dados",
            "salario": "R$ 6.000,00",
            "email": "contato@empresaG.com",
            "telefone": "(11) 2345-9876",
            "website": "www.empresaG.com"
        },
        {
            "id": 12,
            "descricao": "Analista de Segurança da Informação",
            "empresa": "Empresa H",
            "sobreaempresa": "Empresa H é uma empresa de consultoria em segurança da informação.",
            "sobreavaga": "Estamos contratando um analista de segurança da informação para avaliar a segurança dos sistemas.",
            "tempo": "Integral",
            "cargo": "Analista de Segurança da Informação",
            "nivel": "Sênior",
            "competenciadavaga": "Testes de invasão;Avaliação de riscos",
            "salario": "R$ 9.000,00",
            "email": "contato@empresaH.com",
            "telefone": "(11) 7654-3210",
            "website": "www.empresaH.com"
        },
        {
            "id": 13,
            "descricao": "Programador Java",
            "empresa": "Empresa I",
            "sobreaempresa": "Empresa I é uma empresa de desenvolvimento de software com foco em soluções empresariais.",
            "sobreavaga": "Estamos em busca de um programador Java para desenvolver sistemas corporativos.",
            "tempo": "Integral",
            "cargo": "Programador Java",
            "nivel": "Pleno",
            "competenciadavaga": "Java;Spring;Bancos de dados;SQL",
            "salario": "R$ 6.500,00",
            "email": "contato@empresaI.com",
            "telefone": "(11) 5432-1098",
            "website": "www.empresaI.com"
        },
        {
            "id": 14,
            "descricao": "Designer UX/UI",
            "empresa": "Empresa J",
            "sobreaempresa": "Empresa J é uma agência de design com foco em experiência do usuário.",
            "sobreavaga": "Estamos contratando um designer UX/UI para criar interfaces intuitivas e agradáveis.",
            "tempo": "Integral",
            "cargo": "Designer UX/UI",
            "nivel": "Júnior",
            "competenciadavaga": "Conhecimento em design de interfaces;Ferramentas de prototipagem;Usabilidade",
            "salario": "R$ 4.500,00",
            "email": "contato@empresaJ.com",
            "telefone": "(11) 9876-5432",
            "website": "www.empresaJ.com"
        }
    ]
}

var AuxCompetencias = {
    "data": [
        {
            "id": "1",
            "descricao": "Desenvolvimento de back-end",
        },
        {
            "id": "2",
            "descricao": "CSS",
        },
        {
            "id": "3",
            "descricao": "Desenvolvimento de Front-end",
        },
        {
            "id": "4",
            "descricao": "ERP",
        },
        {
            "id": "5",
            "descricao": "Go",
        },
        {
            "id": "6",
            "descricao": "JQuery",
        },
        {
            "id": "7",
            "descricao": "JavaScript",
        },
        {
            "id": "8",
            "descricao": "Lógica",
        },
        {
            "id": "9",
            "descricao": "PHP",
        },
        {
            "id": "10",
            "descricao": "HTML",
        },
        {
            "id": "11",
            "descricao": "html5",
        },
        {
            "id": "12",
            "descricao": "delphi",
        },
        {
            "id": "13",
            "descricao": "React",
        },
        {
            "id": "14",
            "descricao": "React-native",
        },
        {
            "id": "16",
            "descricao": "Banco de Dados",
        },
        {
            "id": "17",
            "descricao": "web Design",
        },
        {
            "id": "18",
            "descricao": "UX/UI",
        },
        {
            "id": "19",
            "descricao": "AngularJS",
        },
        {
            "id": "20",
            "descricao": "Java",
        },
        {
            "id": "21",
            "descricao": "Hibernate",
        },
        {
            "id": "22",
            "descricao": "Entity Framework",
        },
        {
            "id": "23",
            "descricao": "Spring",
        },
        {
            "id": "24",
            "descricao": "MS SQL Server",
        },
        {
            "id": "25",
            "descricao": "Banco de dados Oracle",
        },
        {
            "id": "26",
            "descricao": "VueJS",
        },
        {
            "id": "27",
            "descricao": "Node.JS",
        },
        {
            "id": "28",
            "descricao": "Python",
        },
        {
            "id": "29",
            "descricao": "Ionics",
        },
        {
            "id": "30",
            "descricao": "Quasar",
        },
        {
            "id": "31",
            "descricao": "C#",
        },
        {
            "id": "32",
            "descricao": "Docker",
        },
        {
            "id": "33",
            "descricao": "Flutter",
        },
        {
            "id": "34",
            "descricao": "MS Azure Devops",
        },
        {
            "id": "35",
            "descricao": "Flyway",
        },
        {
            "id": "36",
            "descricao": "Clojure",
        },
        {
            "id": "37",
            "descricao": "Recursividade",
        },
        {
            "id": "38",
            "descricao": "Interfaces",
        },
        {
            "id": "39",
            "descricao": "Goroutine",
        },
        {
            "id": "40",
            "descricao": "Reflection",
        },
        {
            "id": "41",
            "descricao": "Padrão REST",
        },
        {
            "id": "42",
            "descricao": "Testes unitários",
        },
        {
            "id": "43",
            "descricao": "Banco de dados PostgreSQL",
        },
        {
            "id": "44",
            "descricao": "LIMS",
        },
        {
            "id": "45",
            "descricao": "JSF (JavaServer Faces)",
        },       
        {
            "id": "47",
            "descricao": "Engenharia de controle e automação",
        },
        {
            "id": "48",
            "descricao": "Desenvolvimento de soluções",
        },
        {
            "id": "49",
            "descricao": "Controle de produção",
        },
        {
            "id": "50",
            "descricao": "Desenvolvimento de sistemas",
        },
        {
            "id": "51",
            "descricao": "Aplicações industriais",
        },
        {
            "id": 52,
            "descricao": "Conhecimento em design de interfaces",
        },
        {
            "id": 53,
            "descricao": "SQL"
        },
        {
            "id": 54,
            "descricao": "Experiência em Análise de requisitos"
        },
        {
            "id": 55,
            "descricao": "Modelagem de dados"
        },
        {
            "id": 56,
            "descricao": "Linguagens de programação"
        },
        {
            "id": 57,
            "descricao": "Frameworks de frontend"
        },
        {
            "id": 58,
            "descricao": "estatística"
        },
        {
            "id": 59,
            "descricao": "Visualização de dados"
        },
        {
            "id": 60,
            "descricao": "Desenvolvimento de aplicativos móveis"
        },
        {
            "id": 61,
            "descricao": "Sistemas embarcados"
        },

        {
            "id": 62,
            "descricao": "Frameworks MVC"
        },
        {
            "id": 63,
            "descricao": "Bancos de dados relacionais"
        },
        {
            "id": 64,
            "descricao": "Testes de invasão"
        },
        {
            "id": 65,
            "descricao": "Avaliação de riscos"
        },
        {
            "id": 66,
            "descricao": "Políticas de segurança"
        },

        {
            "id": 67,
            "descricao": "Ferramentas de prototipagem"
        },
        {
            "id": 68,
            "descricao": "Usabilidade"
        },
        {
            "id": 69,
            "descricao": "Experiência em análise de dados"
        },
        {
            "id": 70,
            "descricao": "Bancos de dados"
        }

    ]
};

// Caso os dados já estejam no Local Storage, caso contrário, carrega os dados iniciais
var dbvagas = JSON.parse(localStorage.getItem('db_vagas'));
if (!dbvagas) {
    dbvagas = db_vagas_inicial
};

// Exibe mensagem em um elemento de ID msg
function displayMessageSucesso(msg) {
    $('#msg').html('<div class="alert alert-success">' + msg + '</div>');
}

function displayMessageErro(msg) {
    $('#msg').html('<div class="alert alert-danger">' + msg + '</div>');
}


function insertVaga(vaga) {
    // Calcula novo Id a partir do último código existente no array (PODE GERAR ERRO SE A BASE ESTIVER VAZIA)
    let novoId = 1;
    if (dbvagas.vagas.length != 0)
        novoId = dbvagas.vagas[dbvagas.vagas.length - 1].id + 1;
    let novaVaga = {
        "id": novoId,
        "descricao": vaga.descricao,
        "empresa": vaga.empresa,
        "sobreaempresa": vaga.sobreaempresa,
        "sobreavaga": vaga.sobreavaga,
        "tempo": vaga.tempo,
        "cargo": vaga.cargo,
        "competenciadavaga": vaga.competenciadavaga,
        "salario": vaga.salario,
        "email": vaga.email,
        "telefone": vaga.telefone,
        "website": vaga.website,
    };

    // Insere o novo objeto no array
    dbvagas.vagas.push(novaVaga);
    displayMessageSucesso("Vaga inserida com sucesso");

    // Atualiza os dados no Local Storage
    localStorage.setItem('db_vagas', JSON.stringify(dbvagas));
}

function updateVaga(id, vaga) {
    // Localiza o indice do objeto a ser alterado no array a partir do seu ID
    let index = dbvagas.vagas.map(obj => obj.id).indexOf(id);

    // Altera os dados do objeto no array
    dbvagas.vagas[index].descricao = vaga.descricao,
        dbvagas.vagas[index].empresa = vaga.empresa,
        dbvagas.vagas[index].sobreaempresa = vaga.sobreaempresa,
        dbvagas.vagas[index].sobreavaga = vaga.sobreavaga,
        dbvagas.vagas[index].tempo = vaga.tempo,
        dbvagas.vagas[index].cargo = vaga.cargo,
        dbvagas.vagas[index].competenciadavaga = vaga.competenciadavaga,
        dbvagas.vagas[index].salario = vaga.salario,
        dbvagas.vagas[index].email = vaga.email
    dbvagas.vagas[index].telefone = vaga.telefone
    dbvagas.vagas[index].website = vaga.website

    displayMessageSucesso("Vaga alterada com sucesso");

    // Atualiza os dados no Local Storage
    localStorage.setItem('db_vagas', JSON.stringify(dbvagas));
}

function deleteVaga(id) {
    // Filtra o array removendo o elemento com o id passado
    dbvagas.vagas = dbvagas.vagas.filter(function (element) { return element.id != id });

    displayMessageSucesso("Vaga removida com sucesso");

    // Atualiza os dados no Local Storage
    localStorage.setItem('db_vagas', JSON.stringify(ddbvagas));
}

function getCompentenciasVaga(idvaga) {

    let indexvaga = dbvagas.vagas.map(obj => obj.id).indexOf(idvaga);
    let vaga = dbvagas.vagas[indexvaga];
    let Arraycompetenciavaga = new Array();
    if (vaga) {
        let competenciasdavaga = vaga.competenciadavaga;
        Arraycompetenciavaga = competenciasdavaga.split(";");
    }
    return Arraycompetenciavaga;
}

function getCompentenciasVagaUser(idvaga) {

    let indexvaga = dbvagas.vagas.map(obj => obj.id).indexOf(idvaga);
    let vaga = dbvagas.vagas[indexvaga];
    let competenciasdavaga = vaga.competenciadavaga;
    let Arraycompetenciavaga = competenciasdavaga.split(";");

    //habilidades
    let indexhabilidade = db_curriculo.habilidades.map(obj => obj.codusuario).indexOf(usuarioCorrente.codigo);
    let Habilidade = db_curriculo.habilidades[indexhabilidade];
    let Arraycompetenciahabilidade = '';
    if (Habilidade) {
        let competenciasdahabilidade = Habilidade.competenciasuser;
        Arraycompetenciahabilidade = competenciasdahabilidade.split(";");
    }

    let returncompetencias = new Array();
    let contcompetencias = 0;
    if (Arraycompetenciavaga && Arraycompetenciahabilidade) {
        for (var x = 0; x < Arraycompetenciavaga.length; x++) {
            let Auxcompetenciavaga = Arraycompetenciavaga[x];
            for (var y = 0; y < Arraycompetenciahabilidade.length; y++) {
                let Auxcompetenciahabilidade = Arraycompetenciahabilidade[y];
                if ((Auxcompetenciavaga != "" && Auxcompetenciahabilidade != "") && (Auxcompetenciavaga == Auxcompetenciahabilidade)) {
                    returncompetencias[contcompetencias] = Auxcompetenciahabilidade;
                    contcompetencias++;
                }
            }
        }
    }

    return returncompetencias;
}

function getPendenciasCompVagaUser(idvaga) {

    let returncompetencias = new Array();

    let CompVagaXCompUser = getCompentenciasVagaUser(idvaga);

    let indexvaga = dbvagas.vagas.map(obj => obj.id).indexOf(idvaga);
    let vaga = dbvagas.vagas[indexvaga];
    let competenciasdavaga = vaga.competenciadavaga;
    let Arraycompetenciavaga = competenciasdavaga.split(";");

    if (CompVagaXCompUser && Arraycompetenciavaga) {
        returncompetencias = Arraycompetenciavaga.filter((element) => !CompVagaXCompUser.includes(element));
    }

    return returncompetencias;
}

function getVaga(idvaga) {
    let indexvaga = dbvagas.vagas.map(obj => obj.id).indexOf(idvaga);
    let vaga = dbvagas.vagas[indexvaga];
    return vaga;
}